{"version":3,"sources":["../../src/globalNavigation/globalNavigationViewModel.js"],"names":["globalNavigation","node","routes","observableArray","navLinks","activeLink","walkGetTypes","nodes","reduce","types","concat","type","children","forEach","route","addNav","routeInfo","name","get","replace","path","ajax","err","metadata","_","uniq","Array","isArray","filter","indexOf","console","log","content","init","initial","subscribe","oldRoutes","removeNav","routeOptions","text","dispose"],"mappings":";;;;;kBAMwBA,gB;;AANxB;;AACA;;AACA;;;;AACA;;AACA;;;;;;AAEe,SAASA,gBAAT,CAA0BC,IAA1B,EAAgC;AAC3C,QAAIC,SAAS,mBAAGC,eAAH,CAAmBF,KAAKC,MAAxB,CAAb;AAAA,QACIE,WAAW,qBAAWA,QAD1B;AAAA,QAEIC,aAAa,qBAAWA,UAF5B;;AAIA,aAASC,YAAT,CAAsBC,KAAtB,EAA6B;AACzB,eAAO,CAACA,SAAS,EAAV,EACFC,MADE,CACM,UAACC,KAAD,EAAQR,IAAR;AAAA,mBAAiBQ,MAAMC,MAAN,CAAa,CAACT,KAAKU,IAAN,CAAb,EACzBD,MADyB,CAClBJ,aAAaL,KAAKW,QAAlB,CADkB,CAAjB;AAAA,SADN,EAEmC,EAFnC,CAAP;AAGH;;AAEDV,aAASW,OAAT,CAAiB,UAAUC,KAAV,EAAiB;AAC9B,6BAAWC,MAAX,CAAkBD,KAAlB,EAAyB,UAAUE,SAAV,EAAqB;AAC1C,gBAAIC,OAAOH,MAAMI,GAAN,CAAUC,OAAV,CAAkB,QAAlB,EAA4BH,UAAUI,IAAV,GAAiB,MAAMJ,UAAUI,IAAV,CAAeD,OAAf,CAAuB,GAAvB,EAA2B,GAA3B,CAAvB,GAAyD,EAArF,CAAX;AACA,kCAAYE,IAAZ,CAAiB,EAAE,OAAOJ,IAAT,EAAjB,EAAkC,UAAUK,GAAV,EAAeC,QAAf,EAAyB;AACvD,oBAAID,GAAJ,EAAS;AACL;AACH;AACD,oBAAIb,QAAQe,EAAEC,IAAF,CAAOnB,aAAaoB,MAAMC,OAAN,CAAcJ,QAAd,IAA0BA,QAA1B,GAAqC,CAACA,QAAD,CAAlD,CAAP,EAAsEK,MAAtE,CAA6E,UAAUjB,IAAV,EAAgB;AACrG,2BAAOA,QAAQ,mCAAqBkB,OAArB,CAA6BlB,IAA7B,MAAuC,CAAC,CAAvD;AACH,iBAFW,CAAZ;AAGAmB,wBAAQC,GAAR,CAAY,gBAAZ,EAA8BtB,KAA9B;;AAEA,iCAAOuB,OAAP,CAAeT,QAAf;AACH,aAVD;AAWH,SAbD;AAcH,KAfD;;AAiBA,yBAAWU,IAAX,CAAgBhC,KAAKiC,OAAL,IAAgB,CAAhC;;AAEAhC,WAAOiC,SAAP,CAAiB,UAAUC,SAAV,EAAqB;AAClCA,kBAAUvB,OAAV,CAAkB,wBAAgB;AAC9B,iCAAWwB,SAAX,CAAqBC,aAAaC,IAAlC;AACH,SAFD;AAGH,KAJD,EAIG,IAJH,EAIS,cAJT;;AAMA,WAAO,qBAAMtC,IAAN,EAAY;AACfG,kBAAUA,QADK;AAEfC,oBAAYA,UAFG;AAGfmC,iBAAS,mBAAY;AACjBtC,mBAAO,EAAP;AACH;AALc,KAAZ,CAAP;AAOH","file":"globalNavigationViewModel.js","sourcesContent":["import { getRegisteredTypes } from 'scalejs.metadataFactory';\r\nimport { navigation, layout } from 'scalejs.navigation';\r\nimport dataservice from 'dataservice';\r\nimport { merge } from 'scalejs';\r\nimport ko from 'knockout';\r\n\r\nexport default function globalNavigation(node) {\r\n    var routes = ko.observableArray(node.routes),\r\n        navLinks = navigation.navLinks,\r\n        activeLink = navigation.activeLink;\r\n\r\n    function walkGetTypes(nodes) {\r\n        return (nodes || [])\r\n            .reduce( (types, node) => types.concat([node.type])\r\n            .concat(walkGetTypes(node.children)), []);\r\n    }\r\n\r\n    routes().forEach(function (route) {\r\n        navigation.addNav(route, function (routeInfo) {\r\n            var name = route.get.replace('{path}', routeInfo.path ? '_' + routeInfo.path.replace('/','_') : '');\r\n            dataservice.ajax({ 'uri': name }, function (err, metadata) {\r\n                if (err) {\r\n                    return;\r\n                }\r\n                var types = _.uniq(walkGetTypes(Array.isArray(metadata) ? metadata : [metadata])).filter(function (type) {\r\n                    return type && getRegisteredTypes().indexOf(type) === -1\r\n                });\r\n                console.log('Missing types:', types);\r\n\r\n                layout.content(metadata);\r\n            });\r\n        });\r\n    });\r\n\r\n    navigation.init(node.initial || 0);\r\n\r\n    routes.subscribe(function (oldRoutes) {\r\n        oldRoutes.forEach(routeOptions => {\r\n            navigation.removeNav(routeOptions.text);\r\n        });\r\n    }, null, 'beforeChange');\r\n\r\n    return merge(node, {\r\n        navLinks: navLinks,\r\n        activeLink: activeLink,\r\n        dispose: function () {\r\n            routes([]);\r\n        }\r\n    });\r\n}\r\n"]}