{"version":3,"sources":["../../src/listAdvanced/listAdvancedBindings.js"],"names":["sticky","_el","style","transform","scrollTop","css","cellClasses","attr","colspan","ctx","editMode","context","$parent","readonly","click","clickOff","excludes","handler","group","listViewModel","$parents","groupActions","cloneDeep","groupActionViewModels","call","metadata","getValue","id","template","name","data","showSpacer","currentGroupIndex","Number","$data","Object","keys","groups","map","groupKey","slice","reduce","previousHasSpacer","index","ret","previousGroup","toString","length","if"],"mappings":";;;;;;AAAA;;AACA;;;;;;AACI,SAASA,MAAT,CAAiBC,GAAjB,EAAsB;AAClBA,QAAIC,KAAJ,CAAUC,SAAV,GAAsB,gBAAc,KAAKC,SAAnB,GAA6B,KAAnD;AACH;;kBAEc;AACX,0BAAsB,4BAAY;AAC9B,eAAO;AACHC,iBAAK,KAAKC,WADP;AAEHC,kBAAM;AACFC,yBAAS,KAAKA,OAAL,IAAgB;AADvB;AAFH,SAAP;AAMH,KARU;AASX,kCAA8B,iCAAUC,GAAV,EAAe;AACzC,YAAIC,WAAW,KAAKA,QAApB;AAAA,YACIC,UAAUF,IAAIG,OAAJ,CAAYD,OAAZ,IAAuB,EADrC;AAAA,YAEIE,WAAWF,QAAQE,QAAR,GAAmBF,QAAQE,QAAR,EAAnB,GAAwC,KAFvD;;AAIA,eAAO;AACHR,iBAAK;AACD,6BAAaK,cAAc,CAACG;AAD3B,aADF;AAIHC,mBAAO,iBAAY;AACfJ,yBAAS,IAAT;AACA,uBAAO,IAAP;AACH,aAPE;AAQHK,sBAAU;AACNC,0BAAU,CAAC,iBAAD,CADJ;AAENC,yBAAS,mBAAY;AACjBP,6BAAS,KAAT;AACH;AAJK;AARP,SAAP;AAeH,KA7BU;AA8BX,mCAA+B,kCAAUD,GAAV,EAAe;AAC1C,YAAIS,QAAQT,IAAIG,OAAhB;AAAA,YACIO,gBAAgBV,IAAIW,QAAJ,CAAa,CAAb,CADpB;AAAA,YAEIC,eAAe,iBAAEC,SAAF,CAAYH,cAAcE,YAA1B,CAFnB;AAAA,YAGIE,qBAHJ;;AAKA,YAAI,CAACF,YAAL,EAAmB;AACf;AACH;;AAEDE,gCAAwB,0BAAiBC,IAAjB,CAAsB;AAC1CC,sBAAU,EADgC;AAE1CC,sBAAU,kBAAUC,EAAV,EAAc;AACpB,oBAAIA,OAAO,OAAX,EAAoB;AAChB,2BAAOT,KAAP;AACH;AACD,uBAAOC,cAAcR,OAAd,CAAsBe,QAAtB,CAA+BC,EAA/B,CAAP;AACH;AAPyC,SAAtB,EAQrBN,YARqB,CAAxB;;AAWA,eAAO;AACHO,sBAAU;AACNC,sBAAM,yBADA;AAENC,sBAAMP;AAFA;AADP,SAAP;AAMH,KAzDU;AA0DX,sCAAkC,oCAAUd,GAAV,EAAe;AAC7C,YAAIsB,aAAa,KAAjB;AAAA,YACIC,oBAAoBC,OAAOxB,IAAIyB,KAAX,IAAoB,CAD5C;;AAGAH,qBAAaI,OAAOC,IAAP,CAAY3B,IAAIG,OAAJ,CAAYyB,MAAZ,EAAZ,EACRC,GADQ,CACJ,UAAUC,QAAV,EAAoB;AACrB,mBAAO9B,IAAIG,OAAJ,CAAYyB,MAAZ,GAAqBE,QAArB,CAAP;AACH,SAHQ,EAIRC,KAJQ,CAIF,CAJE,EAICR,oBAAmB,CAJpB,EAKRS,MALQ,CAKD,UAAUC,iBAAV,EAA6BxB,KAA7B,EAAoCyB,KAApC,EAA2C;AAC/C,gBAAIC,GAAJ;AAAA,gBACIC,gBAAgBpC,IAAIG,OAAJ,CAAYyB,MAAZ,GAAqBM,MAAMG,QAAN,EAArB,CADpB;;AAGA,gBAAG,CAACD,aAAJ,EAAmB;AACf,uBAAO,KAAP;AACH;;AAED,gBAAI,CAACA,cAAcE,MAAd,IAAwBL,oBAAoB,CAApB,GAAwB,CAAhD,CAAD,IAAuD,CAAvD,KAA6D,CAAjE,EAAoE;AAChE,uBAAO,IAAP;AACH,aAFD,MAEO;AACH,uBAAO,KAAP;AACH;AACJ,SAlBQ,EAkBN,KAlBM,CAAb;;AAoBA,eAAO;AACHM,gBAAIjB;AADD,SAAP;AAGH;AArFU,C","file":"listAdvancedBindings.js","sourcesContent":["import { createViewModels } from 'scalejs.metadataFactory';\r\nimport _ from 'lodash';\r\n    function sticky( _el ){\r\n        _el.style.transform = \"translateY(\"+this.scrollTop+\"px)\";\r\n    }\r\n\r\n    export default {\r\n        'list-advanced-cell': function () {\r\n            return {\r\n                css: this.cellClasses,\r\n                attr: {\r\n                    colspan: this.colspan || 1\r\n                }\r\n            };\r\n        },\r\n        'list-advanced-row-editable': function (ctx) {\r\n            var editMode = this.editMode,\r\n                context = ctx.$parent.context || {},\r\n                readonly = context.readonly ? context.readonly() : false;\r\n\r\n            return {\r\n                css: {\r\n                    'edit-mode': editMode() && !readonly\r\n                },\r\n                click: function () {\r\n                    editMode(true);\r\n                    return true;\r\n                },\r\n                clickOff: {\r\n                    excludes: ['ui-autocomplete'],\r\n                    handler: function () {\r\n                        editMode(false);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        'list-advanced-group-actions': function (ctx) {\r\n            var group = ctx.$parent,\r\n                listViewModel = ctx.$parents[1],\r\n                groupActions = _.cloneDeep(listViewModel.groupActions),\r\n                groupActionViewModels;\r\n\r\n            if (!groupActions) {\r\n                return;\r\n            }\r\n\r\n            groupActionViewModels = createViewModels.call({\r\n                metadata: [],\r\n                getValue: function (id) {\r\n                    if (id === 'group') {\r\n                        return group;\r\n                    }\r\n                    return listViewModel.context.getValue(id);\r\n                }\r\n            }, groupActions);\r\n\r\n\r\n            return {\r\n                template: {\r\n                    name: 'metadata_items_template',\r\n                    data: groupActionViewModels\r\n                }\r\n            };\r\n        },\r\n        'list-advanced-group-row-spacer': function (ctx) {\r\n            var showSpacer = false,\r\n                currentGroupIndex = Number(ctx.$data) - 1;\r\n\r\n            showSpacer = Object.keys(ctx.$parent.groups())\r\n                .map(function (groupKey) {\r\n                    return ctx.$parent.groups()[groupKey];\r\n                })\r\n                .slice(0, currentGroupIndex +1)\r\n                .reduce(function (previousHasSpacer, group, index) {\r\n                    var ret,\r\n                        previousGroup = ctx.$parent.groups()[index.toString()];\r\n\r\n                    if(!previousGroup) {\r\n                        return false;\r\n                    }\r\n\r\n                    if ((previousGroup.length + (previousHasSpacer ? 1 : 0)) % 2 !== 0) {\r\n                        return true;\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                }, false);\r\n\r\n            return {\r\n                if: showSpacer\r\n            };\r\n        }\r\n    };\r\n"]}