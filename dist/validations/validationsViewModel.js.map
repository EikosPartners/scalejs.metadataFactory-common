{"version":3,"sources":["../../src/validations/validationsViewModel.js"],"names":[],"mappings":";;;;;kBAIwB,oB;;AAJxB;;;;AACA;;AACA;;;;AAEe,SAAS,oBAAT,CAA8B,IAA9B,EAAoC;AAC/C,QAAI,SAAS,mBAAG,MAAhB;AAAA,QACI,WAAW,mBAAG,QADlB;AAAA,QAEI,OAAO,EAFX;AAAA,QAGI,kBAHJ;AAAA,QAII,wBAJJ;AAAA,QAKI,yBAAyB,mBAAG,UAAH,CAAc,IAAd,CAL7B;AAAA,QAMI,UAAU,IANd;;AAQA,SAAK,IAAL,CAAU,uBAAQ,QAAQ,EAAR,GAAa,WAArB,EAAkC,UAAU,SAAV,EAAqB;AAC7D,oBAAY,UAAU,EAAE,MAAF,CAAS,QAAQ,UAAR,EAAT,CAAV,CAAZ;AACA,YAAI,CAAC,SAAL,EAAgB;AACZ,yBAAa,UAAU,eAAV,CAA0B,UAAU,OAApC,CAAb;AACH;AACJ,KALS,CAAV;;AAOA,sBAAkB,SAAS,YAAY;AACnC,eAAO,yBAAyB,EAAE,MAAF,CAAS,QAAQ,UAAR,EAAT,CAAzB,CAAP;AACH,KAFiB,EAEf,MAFe,CAER,EAAC,UAAU,IAAX,EAFQ,CAAlB;;AAIA,aAAS,wBAAT,CAAkC,UAAlC,EAA8C;AACtC,eAAO,WAAW,MAAX,CAAkB,UAAU,IAAV,EAAgB,SAAhB,EAA2B;AAChD,gBAAI,GAAJ;;AAEA,gBAAI,UAAU,cAAd,EAA8B;AAC1B,sBAAM,UAAU,cAAV,EAAN;AACA,oBAAI,GAAJ,EAAS;AACL,yBAAK,IAAL,CAAU,GAAV;AACA,2BAAO,IAAP;AACH;AACJ;AACD,mBAAO,EAAE,OAAF,CAAU,KAAK,MAAL,CAAY,GAAZ,CAAV,CAAP;AACA,mBAAO,IAAP;AACH,SAZM,EAYJ,EAZI,CAAP;AAaP;;AAED,aAAS,SAAT,CAAmB,UAAnB,EAA+B;AAC3B,eAAO,WAAW,MAAX,CAAkB,UAAU,SAAV,EAAqB,IAArB,EAA2B;AAChD,gBAAI,KAAK,QAAL,IAAiB,OAAO,KAAK,QAAZ,KAAyB,UAA9C,EAA0D;AACtD,uBAAO,KAAK,QAAL,MAAmB,SAA1B;AACH,aAFD,MAEO;AACH,uBAAO,UAAU,KAAK,gBAAL,IAAyB,EAAnC,KAA0C,SAAjD;AACH;AACJ,SANM,EAMJ,KANI,CAAP;AAOH;;AAED,WAAO,oBAAM,IAAN,EAAY;AACf,wCADe;AAEf,sDAFe;AAGf,iBAAS,mBAAY;AACjB,iBAAK,OAAL,CAAa,UAAU,GAAV,EAAe;AACxB,oBAAI,OAAJ;AACH,aAFD;AAGH;AAPc,KAAZ,CAAP;AASH","file":"validationsViewModel.js","sourcesContent":["import ko from 'knockout';\nimport { merge } from 'scalejs';\nimport { receive } from 'scalejs.messagebus';\n\nexport default function validationsViewModel(node) {\n    let unwrap = ko.unwrap,\n        computed = ko.computed,\n        subs = [],\n        isInvalid,\n        visibleMessages,\n        showValidationMessages = ko.observable(true),\n        context = this;\n\n    subs.push(receive(context.id + '.validate', function (actionObj) {\n        isInvalid = _validate(_.values(context.dictionary()));\n        if (!isInvalid) {\n            actionObj && actionObj.successCallback(actionObj.options);\n        }\n    }));\n\n    visibleMessages = computed(function () {\n        return aggregateVisibleMessages(_.values(context.dictionary()));\n    }).extend({deferred: true});\n\n    function aggregateVisibleMessages(childNodes) {\n            return childNodes.reduce(function (msgs, childNode) {\n                var msg;\n\n                if (childNode.visibleMessage) {\n                    msg = childNode.visibleMessage();\n                    if (msg) {\n                        msgs.push(msg);\n                        return msgs;\n                    }\n                }\n                msgs = _.compact(msgs.concat(msg));\n                return msgs;\n            }, []);\n    }\n\n    function _validate(childNodes) {\n        return childNodes.reduce(function (isInvalid, curr) {\n            if (curr.validate && typeof curr.validate === 'function') {\n                return curr.validate() || isInvalid;\n            } else {\n                return _validate(curr.mappedChildNodes || []) || isInvalid;\n            }\n        }, false);\n    }\n\n    return merge(node, {\n        visibleMessages,\n        showValidationMessages,\n        dispose: function () {\n            subs.forEach(function (sub) {\n                sub.dispose();\n            })\n        }\n    });\n};\n"]}