{"version":3,"sources":["../../src/accordion/accordionBindings.js"],"names":[],"mappings":"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","file":"accordionBindings.js","sourcesContent":["/*global define */\nimport format from 'js-format'; //todo move out\nimport { computed } from 'knockout';\nimport { has } from 'scalejs';\nimport 'ko-bindings/slideVisible';\n\n    //todo evaluate if should move to advanced grid?\n    function aggregateValues(node) {\n        var value;\n        if (node.getValue) {\n            value = [].concat(node.getValue());\n        } else if (node.mappedChildNodes) {\n            value = node.mappedChildNodes.reduce(function (values, childNode) {\n                var childValue = aggregateValues(childNode);\n                if(childValue) {\n                    values = values.concat(childValue);\n                }\n                return values;\n            }, [])\n        }\n        // convert objects to strings\n        value = value.map(function(value) {\n            if (!has(value)) { value = '' }\n            if(typeof value === 'object') {\n                if (value.op) { delete value.op; } // we don't want to custom operators values in preview\n                return value = Object.keys(value).map(function(key) {\n                    if (Date.parse(value[key])) {\n                        return format('MM/DD/YYYY', new Date(value[key]));\n                    } else {\n                        return value[key];\n                    }\n                }).join(' ');\n            }\n            return value;\n        });\n        return value;\n    }\n    \n    export default {\n        'accordion-header': function (ctx) {\n            return {\n                click: this.toggleVisibility,\n                //todo this should be an SVG / class\n                css: {\n                    'fa-caret-down': this.visible(),\n                    'fa-caret-right': !this.visible()\n                }\n\n            }\n        },\n        'accordion-expand-all': function(ctx) {\n            return {\n                click: function () {\n                    ctx.$parents[1].setAllSectionVisibility(true);\n                },\n                clickBubble: false\n            }\n        },\n        'accordion-collapse-all': function(ctx) {\n            return {\n                click: function () {\n                    ctx.$parents[1].setAllSectionVisibility(false);\n                },\n                clickBubble: false\n            }\n        },\n        //todo move to advanced grid\n        'accordion-header-preview-text': function(ctx) {\n            var accordionChild = ctx.$parents[1].mappedChildNodes[ctx.$index()],\n                count = computed(function () {\n                    var values = aggregateValues(accordionChild);\n                    return values.length > 0  && values[0] ? values.length : '';\n                });\n\n            return {\n                text: count\n            };\n        },\n        'accordion-header-text': function (ctx) {\n            return {\n                text: typeof this.header === 'string' ? this.header : this.header.text\n            }\n        },\n        'accordion-sections': function () {\n            var visibleSections = this.sections.filter(function(section) {\n                return !section.isShown || section.isShown();\n            });\n            return {\n                foreach: visibleSections\n            }\n        }\n    }\n\n"]}