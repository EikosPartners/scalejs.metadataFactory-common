{"version":3,"sources":["../../src/accordion/accordionBindings.js"],"names":[],"mappings":"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","file":"accordionBindings.js","sourcesContent":["/*global define */\r\nimport format from 'js-format'; //todo move out\r\nimport { computed } from 'knockout';\r\nimport { has } from 'scalejs';\r\nimport 'ko-bindings/slideVisible';\r\n\r\n    //todo evaluate if should move to advanced grid?\r\n    function aggregateValues(node) {\r\n        var value;\r\n        if (node.getValue) {\r\n            value = [].concat(node.getValue());\r\n        } else if (node.mappedChildNodes) {\r\n            value = node.mappedChildNodes.reduce(function (values, childNode) {\r\n                var childValue = aggregateValues(childNode);\r\n                if(childValue) {\r\n                    values = values.concat(childValue);\r\n                }\r\n                return values;\r\n            }, [])\r\n        }\r\n        // convert objects to strings\r\n        value = value.map(function(value) {\r\n            if (!has(value)) { value = '' }\r\n            if(typeof value === 'object') {\r\n                if (value.op) { delete value.op; } // we don't want to custom operators values in preview\r\n                return value = Object.keys(value).map(function(key) {\r\n                    if (Date.parse(value[key])) {\r\n                        return format('MM/DD/YYYY', new Date(value[key]));\r\n                    } else {\r\n                        return value[key];\r\n                    }\r\n                }).join(' ');\r\n            }\r\n            return value;\r\n        });\r\n        return value;\r\n    }\r\n    \r\n    export default {\r\n        'accordion-header': function (ctx) {\r\n            return {\r\n                click: this.toggleVisibility,\r\n                //todo this should be an SVG / class\r\n                css: {\r\n                    'fa-caret-down': this.visible(),\r\n                    'fa-caret-right': !this.visible()\r\n                }\r\n\r\n            }\r\n        },\r\n        'accordion-expand-all': function(ctx) {\r\n            return {\r\n                click: function () {\r\n                    ctx.$parents[1].setAllSectionVisibility(true);\r\n                },\r\n                clickBubble: false\r\n            }\r\n        },\r\n        'accordion-collapse-all': function(ctx) {\r\n            return {\r\n                click: function () {\r\n                    ctx.$parents[1].setAllSectionVisibility(false);\r\n                },\r\n                clickBubble: false\r\n            }\r\n        },\r\n        //todo move to advanced grid\r\n        'accordion-header-preview-text': function(ctx) {\r\n            var accordionChild = ctx.$parents[1].mappedChildNodes[ctx.$index()],\r\n                count = computed(function () {\r\n                    var values = aggregateValues(accordionChild);\r\n                    return values.length > 0  && values[0] ? values.length : '';\r\n                });\r\n\r\n            return {\r\n                text: count\r\n            };\r\n        },\r\n        'accordion-header-text': function (ctx) {\r\n            return {\r\n                text: typeof this.header === 'string' ? this.header : this.header.text\r\n            }\r\n        },\r\n        'accordion-sections': function () {\r\n            var visibleSections = this.sections.filter(function(section) {\r\n                return !section.isShown || section.isShown();\r\n            });\r\n            return {\r\n                foreach: visibleSections\r\n            }\r\n        }\r\n    }\r\n\r\n"]}