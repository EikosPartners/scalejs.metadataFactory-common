{"version":3,"sources":["../../src/accordion/accordionBindings.js"],"names":["aggregateValues","node","value","getValue","concat","mappedChildNodes","reduce","values","childNode","childValue","map","op","Object","keys","key","Date","parse","join","ctx","click","toggleVisibility","css","visible","fontIcon","$parents","setAllSectionVisibility","clickBubble","accordionChild","$index","count","length","text","header","visibleSections","sections","filter","section","isShown","foreach"],"mappings":";;;;;;kPAAA;AACgC;;;AAAhC;;;;AACA;;AACA;;AACA;;;;AAEI;AACA,SAASA,eAAT,CAAyBC,IAAzB,EAA+B;AAC3B,QAAIC,KAAJ;AACA,QAAID,KAAKE,QAAT,EAAmB;AACfD,gBAAQ,GAAGE,MAAH,CAAUH,KAAKE,QAAL,EAAV,CAAR;AACH,KAFD,MAEO,IAAIF,KAAKI,gBAAT,EAA2B;AAC9BH,gBAAQD,KAAKI,gBAAL,CAAsBC,MAAtB,CAA6B,UAAUC,MAAV,EAAkBC,SAAlB,EAA6B;AAC9D,gBAAIC,aAAaT,gBAAgBQ,SAAhB,CAAjB;AACA,gBAAGC,UAAH,EAAe;AACXF,yBAASA,OAAOH,MAAP,CAAcK,UAAd,CAAT;AACH;AACD,mBAAOF,MAAP;AACH,SANO,EAML,EANK,CAAR;AAOH;AACD;AACAL,YAAQA,MAAMQ,GAAN,CAAU,UAASR,KAAT,EAAgB;AAC9B,YAAI,CAAC,kBAAIA,KAAJ,CAAL,EAAiB;AAAEA,oBAAQ,EAAR;AAAY;AAC/B,YAAG,QAAOA,KAAP,yCAAOA,KAAP,OAAiB,QAApB,EAA8B;AAC1B,gBAAIA,MAAMS,EAAV,EAAc;AAAE,uBAAOT,MAAMS,EAAb;AAAkB,aADR,CACS;AACnC,mBAAOT,QAAQU,OAAOC,IAAP,CAAYX,KAAZ,EAAmBQ,GAAnB,CAAuB,UAASI,GAAT,EAAc;AAChD,oBAAIC,KAAKC,KAAL,CAAWd,MAAMY,GAAN,CAAX,CAAJ,EAA4B;AACxB,2BAAO,wBAAO,YAAP,EAAqB,IAAIC,IAAJ,CAASb,MAAMY,GAAN,CAAT,CAArB,CAAP;AACH,iBAFD,MAEO;AACH,2BAAOZ,MAAMY,GAAN,CAAP;AACH;AACJ,aANc,EAMZG,IANY,CAMP,GANO,CAAf;AAOH;AACD,eAAOf,KAAP;AACH,KAbO,CAAR;AAcA,WAAOA,KAAP;AACH;;kBAEc;AACX,wBAAoB,yBAAUgB,GAAV,EAAe;AAC/B,eAAO;AACHC,mBAAO,KAAKC,gBADT;AAEH;AACAC,iBAAK;AACD,iCAAiB,KAAKC,OAAL,EADhB;AAED,kCAAkB,CAAC,KAAKA,OAAL;AAFlB;;AAHF,SAAP;AASH,KAXU;AAYX,4BAAwB,4BAASJ,GAAT,EAAc;AAClC,eAAO;AACHK,sBAAU,YADP;AAEHJ,mBAAO,iBAAY;AACfD,oBAAIM,QAAJ,CAAa,CAAb,EAAgBC,uBAAhB,CAAwC,IAAxC;AACH,aAJE;AAKHC,yBAAa;AALV,SAAP;AAOH,KApBU;AAqBX,8BAA0B,8BAASR,GAAT,EAAc;AACpC,eAAO;AACHK,sBAAU,cADP;AAEHJ,mBAAO,iBAAY;AACfD,oBAAIM,QAAJ,CAAa,CAAb,EAAgBC,uBAAhB,CAAwC,KAAxC;AACH,aAJE;AAKHC,yBAAa;AALV,SAAP;AAOH,KA7BU;AA8BX;AACA,qCAAiC,oCAASR,GAAT,EAAc;AAC3C,YAAIS,iBAAiBT,IAAIM,QAAJ,CAAa,CAAb,EAAgBnB,gBAAhB,CAAiCa,IAAIU,MAAJ,EAAjC,CAArB;AAAA,YACIC,QAAQ,wBAAS,YAAY;AACzB,gBAAItB,SAASP,gBAAgB2B,cAAhB,CAAb;AACA,mBAAOpB,OAAOuB,MAAP,GAAgB,CAAhB,IAAsBvB,OAAO,CAAP,CAAtB,GAAkCA,OAAOuB,MAAzC,GAAkD,EAAzD;AACH,SAHO,CADZ;;AAMA,eAAO;AACHC,kBAAMF;AADH,SAAP;AAGH,KAzCU;AA0CX,6BAAyB,6BAAUX,GAAV,EAAe;AACpC,eAAO;AACHa,kBAAM,OAAO,KAAKC,MAAZ,KAAuB,QAAvB,GAAkC,KAAKA,MAAvC,GAAgD,KAAKA,MAAL,CAAYD;AAD/D,SAAP;AAGH,KA9CU;AA+CX,0BAAsB,6BAAY;AAC9B,YAAIE,kBAAkB,KAAKC,QAAL,CAAcC,MAAd,CAAqB,UAASC,OAAT,EAAkB;AACzD,mBAAO,CAACA,QAAQC,OAAT,IAAoBD,QAAQC,OAAR,EAA3B;AACH,SAFqB,CAAtB;AAGA,eAAO;AACHC,qBAASL;AADN,SAAP;AAGH;AAtDU,C","file":"accordionBindings.js","sourcesContent":["/*global define */\r\nimport format from 'js-format'; //todo move out\r\nimport { computed } from 'knockout';\r\nimport { has } from 'scalejs';\r\nimport 'ko-bindings/slideVisible';\r\n\r\n    //todo evaluate if should move to advanced grid?\r\n    function aggregateValues(node) {\r\n        var value;\r\n        if (node.getValue) {\r\n            value = [].concat(node.getValue());\r\n        } else if (node.mappedChildNodes) {\r\n            value = node.mappedChildNodes.reduce(function (values, childNode) {\r\n                var childValue = aggregateValues(childNode);\r\n                if(childValue) {\r\n                    values = values.concat(childValue);\r\n                }\r\n                return values;\r\n            }, [])\r\n        }\r\n        // convert objects to strings\r\n        value = value.map(function(value) {\r\n            if (!has(value)) { value = '' }\r\n            if(typeof value === 'object') {\r\n                if (value.op) { delete value.op; } // we don't want to custom operators values in preview\r\n                return value = Object.keys(value).map(function(key) {\r\n                    if (Date.parse(value[key])) {\r\n                        return format('MM/DD/YYYY', new Date(value[key]));\r\n                    } else {\r\n                        return value[key];\r\n                    }\r\n                }).join(' ');\r\n            }\r\n            return value;\r\n        });\r\n        return value;\r\n    }\r\n    \r\n    export default {\r\n        'accordion-header': function (ctx) {\r\n            return {\r\n                click: this.toggleVisibility,\r\n                //todo this should be an SVG / class\r\n                css: {\r\n                    'fa-caret-down': this.visible(),\r\n                    'fa-caret-right': !this.visible()\r\n                }\r\n\r\n            }\r\n        },\r\n        'accordion-expand-all': function(ctx) {\r\n            return {\r\n                fontIcon: 'expand-all',\r\n                click: function () {\r\n                    ctx.$parents[1].setAllSectionVisibility(true);\r\n                },\r\n                clickBubble: false\r\n            }\r\n        },\r\n        'accordion-collapse-all': function(ctx) {\r\n            return {\r\n                fontIcon: 'collapse-all',\r\n                click: function () {\r\n                    ctx.$parents[1].setAllSectionVisibility(false);\r\n                },\r\n                clickBubble: false\r\n            }\r\n        },\r\n        //todo move to advanced grid\r\n        'accordion-header-preview-text': function(ctx) {\r\n            var accordionChild = ctx.$parents[1].mappedChildNodes[ctx.$index()],\r\n                count = computed(function () {\r\n                    var values = aggregateValues(accordionChild);\r\n                    return values.length > 0  && values[0] ? values.length : '';\r\n                });\r\n\r\n            return {\r\n                text: count\r\n            };\r\n        },\r\n        'accordion-header-text': function (ctx) {\r\n            return {\r\n                text: typeof this.header === 'string' ? this.header : this.header.text\r\n            }\r\n        },\r\n        'accordion-sections': function () {\r\n            var visibleSections = this.sections.filter(function(section) {\r\n                return !section.isShown || section.isShown();\r\n            });\r\n            return {\r\n                foreach: visibleSections\r\n            }\r\n        }\r\n    }\r\n\r\n"]}