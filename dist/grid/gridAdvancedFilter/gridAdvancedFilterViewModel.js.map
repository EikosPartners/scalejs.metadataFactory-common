{"version":3,"sources":["../../../src/grid/gridAdvancedFilter/gridAdvancedFilterViewModel.js"],"names":["node","context","id","options","advancedFilter","call","filter","filterData","data","filterDict","dictionary","filterIsVisible","observable","filterText","subs","caseInsensitive","setupReceiveFilter","push","query","filters","Object","keys","forEach","key","inputType","value","date","setupClearFilter","setValue","skip","search","clientSearch","rows","removeAll","dispose","sub"],"mappings":";;;;;;kBAKe,UAAUA,IAAV,EAAgB;AAC3B,QAAMC,UAAU,IAAhB;AAAA,QACIC,KAAKF,KAAKE,EADd;AAAA,QAEIC,UAAUH,KAAKG,OAAL,IAAgB,EAF9B;AAAA,QAGIC,iBAAiB,yBAAgBC,IAAhB,CAAqBJ,OAArB,EAA8BD,KAAKM,MAAnC,CAHrB;AAAA,QAIIC,aAAaH,eAAeH,OAAf,CAAuBO,IAJxC;AAAA,QAI8C;AAC1CC,iBAAaL,eAAeH,OAAf,CAAuBS,UALxC;AAAA,QAMIC,kBAAkB,mBAAGC,UAAH,CAAc,KAAd,CANtB;AAAA,QAOIC,aAAaV,QAAQU,UAAR,IAAsB,UAPvC;AAAA,QAQIC,OAAO,EARX;;AAUA,QAAI,mBAAIX,QAAQY,eAAZ,CAAJ,EAAkC;AAC9Bd,gBAAQc,eAAR,CAAwBZ,QAAQY,eAAhC;AACH;;AAED,aAASC,kBAAT,GAA8B;AAC1BF,aAAKG,IAAL,CAAU,uBAAWjB,KAAKE,EAAhB,cAA6B,YAAM;AACzC,gBAAMgB,QAAQ,EAAd;AAAA,gBACIC,UAAUZ,YADd;;AAGAa,mBAAOC,IAAP,CAAYF,OAAZ,EAAqBG,OAArB,CAA6B,UAACC,GAAD,EAAS;AAClC,oBAAIJ,QAAQI,GAAR,CAAJ,EAAkB;AACd,wBAAId,aAAac,GAAb,EAAkBC,SAAlB,KAAgC,YAApC,EAAkD;AAC9CN,8BAAMK,GAAN,IAAa,EAAb;AACAL,8BAAMK,GAAN,EAAWE,KAAX,GAAmBN,QAAQI,GAAR,CAAnB;AACAL,8BAAMK,GAAN,EAAWG,IAAX,GAAkB,IAAlB;AACH,qBAJD,MAIO;AACHR,8BAAMK,GAAN,IAAaJ,QAAQI,GAAR,CAAb;AACH;AACJ;AACJ,aAVD;AAWAtB,oBAAQkB,OAAR,CAAgBD,KAAhB;AACAP,4BAAgB,KAAhB;AACH,SAjBS,CAAV;AAkBH;;AAED,aAASgB,gBAAT,GAA4B;AACxBb,aAAKG,IAAL,CAAU,uBAAWjB,KAAKE,EAAhB,aAA4B,YAAM;AACxC,gBAAMiB,UAAUZ,YAAhB;AACAa,mBAAOC,IAAP,CAAYF,OAAZ,EAAqBG,OAArB,CAA6B,UAAChB,MAAD,EAAY;AACrC,oBAAIa,QAAQb,MAAR,CAAJ,EAAqB;AACjBG,iCAAaH,MAAb,EAAqBsB,QAArB,CAA8B,EAA9B;AACH;AACJ,aAJD;AAKA3B,oBAAQ4B,IAAR,CAAa,CAAb;AACA5B,oBAAQ6B,MAAR,CAAe,EAAf;AACA7B,oBAAQkB,OAAR,CAAgB,EAAhB;AACAR,4BAAgB,KAAhB;AACA,gBAAI,CAACV,QAAQ8B,YAAb,EAA2B;AACvB9B,wBAAQ+B,IAAR,CAAaC,SAAb;AACH;AACJ,SAdS,CAAV;AAeH;;AAED,aAASC,OAAT,GAAmB;AACfpB,aAAKQ,OAAL,CAAa,UAACa,GAAD,EAAS;AAClBA,gBAAID,OAAJ;AACH,SAFD;AAGH;;AAEDlB;AACAW;;AAEA,WAAO,qBAAM3B,IAAN,EAAY;AACfE,cADe;AAEfD,wBAFe;AAGfiC,wBAHe;AAIf9B,sCAJe;AAKfO,wCALe;AAMfE;AANe,KAAZ,CAAP;AAQH,C;;AA5ED;;AACA;;AACA;;AACA","file":"gridAdvancedFilterViewModel.js","sourcesContent":["import { createViewModel } from 'scalejs.metadataFactory';\r\nimport { receive } from 'scalejs.messagebus';\r\nimport { merge, has } from 'scalejs';\r\nimport ko from 'knockout';\r\n\r\nexport default function (node) {\r\n    const context = this,\r\n        id = node.id,\r\n        options = node.options || {},\r\n        advancedFilter = createViewModel.call(context, node.filter),\r\n        filterData = advancedFilter.context.data, // todo: review\r\n        filterDict = advancedFilter.context.dictionary,\r\n        filterIsVisible = ko.observable(false),\r\n        filterText = options.filterText || 'Advanced',\r\n        subs = [];\r\n\r\n    if (has(options.caseInsensitive)) {\r\n        context.caseInsensitive(options.caseInsensitive);\r\n    }\r\n\r\n    function setupReceiveFilter() {\r\n        subs.push(receive(`${node.id}.filter`, () => {\r\n            const query = {},\r\n                filters = filterData();\r\n\r\n            Object.keys(filters).forEach((key) => {\r\n                if (filters[key]) {\r\n                    if (filterDict()[key].inputType === 'datepicker') {\r\n                        query[key] = {};\r\n                        query[key].value = filters[key];\r\n                        query[key].date = true;\r\n                    } else {\r\n                        query[key] = filters[key];\r\n                    }\r\n                }\r\n            });\r\n            context.filters(query);\r\n            filterIsVisible(false);\r\n        }));\r\n    }\r\n\r\n    function setupClearFilter() {\r\n        subs.push(receive(`${node.id}.clear`, () => {\r\n            const filters = filterData();\r\n            Object.keys(filters).forEach((filter) => {\r\n                if (filters[filter]) {\r\n                    filterDict()[filter].setValue('');\r\n                }\r\n            });\r\n            context.skip(0);\r\n            context.search('');\r\n            context.filters({});\r\n            filterIsVisible(false);\r\n            if (!context.clientSearch) {\r\n                context.rows.removeAll();\r\n            }\r\n        }));\r\n    }\r\n\r\n    function dispose() {\r\n        subs.forEach((sub) => {\r\n            sub.dispose();\r\n        });\r\n    }\r\n\r\n    setupReceiveFilter();\r\n    setupClearFilter();\r\n\r\n    return merge(node, {\r\n        id,\r\n        context,\r\n        dispose,\r\n        advancedFilter,\r\n        filterIsVisible,\r\n        filterText\r\n    });\r\n}"]}