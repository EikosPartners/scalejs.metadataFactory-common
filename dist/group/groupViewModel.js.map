{"version":3,"sources":["../../src/group/groupViewModel.js"],"names":["node","dictionary","context","mappedChildNodes","call","children","sub","createNodeDictionary","setValue","values","opts","value","originalDict","Object","keys","forEach","id","child","prototype","hasOwnProperty","isEqual","getValue","ret","reduce","obj","rendered","trackChildrenIfHidden","trackIfHidden","update","console","info","dispose","addToDictionary"],"mappings":";;;;;;kBAqBe,UAAUA,IAAV,EAAgB;AAC3B,QAAMC,aAAa,2BAAnB;AAAA,QACIC,UAAU,IADd;AAAA,QAEIC,mBAAmB,2BAAiBC,IAAjB,CAAsB,IAAtB,EAA4BJ,KAAKK,QAAjC,CAFvB;AAAA,QAGIC,MAAM,wBAAS;AAAA,eAAML,WAAWM,qBAAqBJ,gBAArB,CAAX,CAAN;AAAA,KAAT,CAHV;;AAMA,aAASK,QAAT,CAAkBC,MAAlB,EAA0BC,IAA1B,EAAgC;AAC5B,YAAMC,QAAQ,CAAC,kBAAIF,MAAJ,EAAY,OAAZ,IAAuBA,OAAOE,KAA9B,GAAsCF,MAAvC,KAAkD,EAAhE;AAAA,YACIG,eAAeC,OAAOC,IAAP,CAAYb,YAAZ,CADnB;;AAGAY,eAAOC,IAAP,CAAYb,YAAZ,EAA0Bc,OAA1B,CAAkC,UAACC,EAAD,EAAQ;AACtC,gBAAMC,QAAQhB,aAAae,EAAb,CAAd;AACA,gBAAIC,MAAMT,QAAN,IAAkBK,OAAOK,SAAP,CAAiBC,cAAjB,CAAgCf,IAAhC,CAAqCO,KAArC,EAA4CM,MAAMD,EAAlD,CAAtB,EAA6E;AACzEC,sBAAMT,QAAN,CAAeG,MAAMM,MAAMD,EAAZ,CAAf,EAAgCN,IAAhC;AACH;AACJ,SALD;;AAOA,YAAI,CAAC,iBAAEU,OAAF,CAAUR,YAAV,EAAwBC,OAAOC,IAAP,CAAYb,YAAZ,CAAxB,CAAL,EAAyD;AACrDO,qBAASC,MAAT,EAAiBC,IAAjB;AACH;AACJ;;AAED,aAASW,QAAT,GAAoB;AAChB,YAAMC,MAAMT,OAAOC,IAAP,CAAYb,YAAZ,EAA0BsB,MAA1B,CAAiC,UAACC,GAAD,EAAMR,EAAN,EAAa;AACtD,gBAAMC,QAAQhB,aAAae,EAAb,CAAd;AACA,gBAAKC,MAAMI,QAAN,KACJJ,MAAMQ,QAAN,MAAoBzB,KAAK0B,qBAAL,KAA+B,KAAnD,IAA4DT,MAAMU,aAD9D,CAAL,EACoF;AAChFH,oBAAIP,MAAMD,EAAV,IAAgBC,MAAMI,QAAN,EAAhB;AACH,aAHD,MAGO;AACH,uBAAOG,IAAIP,MAAMD,EAAV,CAAP,CADG,CACmB;AACzB;AACD,mBAAOQ,GAAP;AACH,SATW,EAST,EATS,CAAZ;AAUA,eAAOF,GAAP;AACH;;AAED,aAASM,MAAT,CAAgBjB,KAAhB,EAAuB;AACnBkB,gBAAQC,IAAR,CAAa,qCAAb;AACAtB,iBAASG,KAAT;AACH;;AAED,WAAO,oBAAMX,IAAN,EAAY;AACfG,0CADe;AAEfF,8BAFe;AAGfO,0BAHe;AAIfa,0BAJe;AAKfnB,wBALe;AAMf0B,sBANe;AAOfG,eAPe,qBAOL;AACNzB,gBAAIyB,OAAJ;AACH;AATc,KAAZ,CAAP;AAWH,C;;AA1ED;;AACA;;AACA;;AACA;;;;;;AAEA,SAASxB,oBAAT,CAA8BJ,gBAA9B,EAAgD;AAC5C,QAAMF,aAAa,EAAnB;;AAEA,aAAS+B,eAAT,CAAyBhC,IAAzB,EAA+B;AAC3B,YAAIA,KAAKgB,EAAT,EAAa;AACTf,uBAAWD,KAAKgB,EAAhB,IAAsBhB,IAAtB;AACH;AACD,YAAI,CAACA,KAAKqB,QAAV,EAAoB;AAChB,aAAC,sBAAOrB,KAAKG,gBAAZ,KAAiC,EAAlC,EAAsCY,OAAtC,CAA8CiB,eAA9C;AACH;AACJ;AACD,KAAC,sBAAO7B,gBAAP,KAA4B,EAA7B,EAAiCY,OAAjC,CAAyCiB,eAAzC;;AAEA,WAAO/B,UAAP;AACH","file":"groupViewModel.js","sourcesContent":["import { observable, unwrap, computed } from 'knockout';\r\nimport { has, merge } from 'scalejs';\r\nimport { createViewModels } from 'scalejs.metadataFactory';\r\nimport _ from 'lodash';\r\n\r\nfunction createNodeDictionary(mappedChildNodes) {\r\n    const dictionary = {};\r\n\r\n    function addToDictionary(node) {\r\n        if (node.id) {\r\n            dictionary[node.id] = node;\r\n        }\r\n        if (!node.getValue) {\r\n            (unwrap(node.mappedChildNodes) || []).forEach(addToDictionary);\r\n        }\r\n    }\r\n    (unwrap(mappedChildNodes) || []).forEach(addToDictionary);\r\n\r\n    return dictionary;\r\n}\r\n\r\nexport default function (node) {\r\n    const dictionary = observable(),\r\n        context = this,\r\n        mappedChildNodes = createViewModels.call(this, node.children),\r\n        sub = computed(() => dictionary(createNodeDictionary(mappedChildNodes)));\r\n\r\n\r\n    function setValue(values, opts) {\r\n        const value = (has(values, 'value') ? values.value : values) || {},\r\n            originalDict = Object.keys(dictionary());\r\n\r\n        Object.keys(dictionary()).forEach((id) => {\r\n            const child = dictionary()[id];\r\n            if (child.setValue && Object.prototype.hasOwnProperty.call(value, child.id)) {\r\n                child.setValue(value[child.id], opts);\r\n            }\r\n        });\r\n\r\n        if (!_.isEqual(originalDict, Object.keys(dictionary()))) {\r\n            setValue(values, opts);\r\n        }\r\n    }\r\n\r\n    function getValue() {\r\n        const ret = Object.keys(dictionary()).reduce((obj, id) => {\r\n            const child = dictionary()[id];\r\n            if ((child.getValue &&\r\n            (child.rendered() || node.trackChildrenIfHidden !== false || child.trackIfHidden))) {\r\n                obj[child.id] = child.getValue();\r\n            } else {\r\n                delete obj[child.id]; // track if hidden functionality for group..\r\n            }\r\n            return obj;\r\n        }, {});\r\n        return ret;\r\n    }\r\n\r\n    function update(value) {\r\n        console.info('Group only supports udate for value');\r\n        setValue(value);\r\n    }\r\n\r\n    return merge(node, {\r\n        mappedChildNodes,\r\n        dictionary,\r\n        setValue,\r\n        getValue,\r\n        context,\r\n        update,\r\n        dispose() {\r\n            sub.dispose();\r\n        }\r\n    });\r\n}"]}