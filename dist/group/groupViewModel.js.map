{"version":3,"sources":["../../src/group/groupViewModel.js"],"names":["node","dictionary","context","mappedChildNodes","call","children","sub","createNodeDictionary","setValue","values","opts","value","Object","keys","forEach","id","child","prototype","hasOwnProperty","getValue","ret","reduce","obj","update","console","info","dispose","addToDictionary"],"mappings":";;;;;;kBAoBe,UAAUA,IAAV,EAAgB;AAC3B,QAAMC,aAAa,2BAAnB;AAAA,QACIC,UAAU,IADd;AAAA,QAEIC,mBAAmB,2BAAiBC,IAAjB,CAAsB,IAAtB,EAA4BJ,KAAKK,QAAjC,CAFvB;AAAA,QAGIC,MAAM,wBAAS;AAAA,eAAML,WAAWM,qBAAqBJ,gBAArB,CAAX,CAAN;AAAA,KAAT,CAHV;;AAMA,aAASK,QAAT,CAAkBC,MAAlB,EAA0BC,IAA1B,EAAgC;AAC5B,YAAMC,QAAQ,CAAC,kBAAIF,MAAJ,EAAY,OAAZ,IAAuBA,OAAOE,KAA9B,GAAsCF,MAAvC,KAAkD,EAAhE;AACAG,eAAOC,IAAP,CAAYZ,YAAZ,EAA0Ba,OAA1B,CAAkC,UAACC,EAAD,EAAQ;AACtC,gBAAMC,QAAQf,aAAac,EAAb,CAAd;AACA,gBAAIC,MAAMR,QAAN,IAAkBI,OAAOK,SAAP,CAAiBC,cAAjB,CAAgCd,IAAhC,CAAqCO,KAArC,EAA4CK,MAAMD,EAAlD,CAAtB,EAA6E;AACzEC,sBAAMR,QAAN,CAAeG,MAAMK,MAAMD,EAAZ,CAAf,EAAgCL,IAAhC;AACH;AACJ,SALD;AAMH;;AAED,aAASS,QAAT,GAAoB;AAChB,YAAMC,MAAMR,OAAOC,IAAP,CAAYZ,YAAZ,EAA0BoB,MAA1B,CAAiC,UAACC,GAAD,EAAMP,EAAN,EAAa;AACtD,gBAAMC,QAAQf,aAAac,EAAb,CAAd;AACA,gBAAIC,MAAMG,QAAV,EAAoB;AAChBG,oBAAIN,MAAMD,EAAV,IAAgBC,MAAMG,QAAN,EAAhB;AACH;AACD,mBAAOG,GAAP;AACH,SANW,EAMT,EANS,CAAZ;AAOA,eAAOF,GAAP;AACH;;AAED,aAASG,MAAT,CAAgBZ,KAAhB,EAAuB;AACnBa,gBAAQC,IAAR,CAAa,qCAAb;AACAjB,iBAASG,KAAT;AACH;;AAED,WAAO,oBAAMX,IAAN,EAAY;AACfG,0CADe;AAEfF,8BAFe;AAGfO,0BAHe;AAIfW,0BAJe;AAKfjB,wBALe;AAMfqB,sBANe;AAOfG,eAPe,qBAOL;AACNpB,gBAAIoB,OAAJ;AACH;AATc,KAAZ,CAAP;AAWH,C;;AAhED;;AACA;;AACA;;AAEA,SAASnB,oBAAT,CAA8BJ,gBAA9B,EAAgD;AAC5C,QAAMF,aAAa,EAAnB;;AAEA,aAAS0B,eAAT,CAAyB3B,IAAzB,EAA+B;AAC3B,YAAIA,KAAKe,EAAT,EAAa;AACTd,uBAAWD,KAAKe,EAAhB,IAAsBf,IAAtB;AACH;AACD,YAAI,CAACA,KAAKmB,QAAV,EAAoB;AAChB,aAAC,sBAAOnB,KAAKG,gBAAZ,KAAiC,EAAlC,EAAsCW,OAAtC,CAA8Ca,eAA9C;AACH;AACJ;AACD,KAAC,sBAAOxB,gBAAP,KAA4B,EAA7B,EAAiCW,OAAjC,CAAyCa,eAAzC;;AAEA,WAAO1B,UAAP;AACH","file":"groupViewModel.js","sourcesContent":["import { observable, unwrap, computed } from 'knockout';\r\nimport { has, merge } from 'scalejs';\r\nimport { createViewModels } from 'scalejs.metadataFactory';\r\n\r\nfunction createNodeDictionary(mappedChildNodes) {\r\n    const dictionary = {};\r\n\r\n    function addToDictionary(node) {\r\n        if (node.id) {\r\n            dictionary[node.id] = node;\r\n        }\r\n        if (!node.getValue) {\r\n            (unwrap(node.mappedChildNodes) || []).forEach(addToDictionary);\r\n        }\r\n    }\r\n    (unwrap(mappedChildNodes) || []).forEach(addToDictionary);\r\n\r\n    return dictionary;\r\n}\r\n\r\nexport default function (node) {\r\n    const dictionary = observable(),\r\n        context = this,\r\n        mappedChildNodes = createViewModels.call(this, node.children),\r\n        sub = computed(() => dictionary(createNodeDictionary(mappedChildNodes)));\r\n\r\n\r\n    function setValue(values, opts) {\r\n        const value = (has(values, 'value') ? values.value : values) || {};\r\n        Object.keys(dictionary()).forEach((id) => {\r\n            const child = dictionary()[id];\r\n            if (child.setValue && Object.prototype.hasOwnProperty.call(value, child.id)) {\r\n                child.setValue(value[child.id], opts);\r\n            }\r\n        });\r\n    }\r\n\r\n    function getValue() {\r\n        const ret = Object.keys(dictionary()).reduce((obj, id) => {\r\n            const child = dictionary()[id];\r\n            if (child.getValue) {\r\n                obj[child.id] = child.getValue();\r\n            }\r\n            return obj;\r\n        }, {});\r\n        return ret;\r\n    }\r\n\r\n    function update(value) {\r\n        console.info('Group only supports udate for value');\r\n        setValue(value);\r\n    }\r\n\r\n    return merge(node, {\r\n        mappedChildNodes,\r\n        dictionary,\r\n        setValue,\r\n        getValue,\r\n        context,\r\n        update,\r\n        dispose() {\r\n            sub.dispose();\r\n        }\r\n    });\r\n}"]}