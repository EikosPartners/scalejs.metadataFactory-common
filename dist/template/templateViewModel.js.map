{"version":3,"sources":["../../src/template/templateViewModel.js"],"names":["templateViewModel","node","data","hasOwnProperty","context","options","createContext","metadata","createViewModel","bind","createViewModels","isShown","visible","actionNode","action","mappedChildNodes","registeredTemplates","template","console","error","children","dataSourceEndpoint","callback","err","results","log"],"mappings":";;;;;kBAOwBA,iB;;AAPxB;;AAEA;;AACA;;AACA;;AACA;;AAEe,SAASA,iBAAT,CAA2BC,IAA3B,EAAiC;AAC5C,QAAIC,OAAO,0BAAWD,KAAKE,cAAL,CAAoB,MAApB,IAA8BF,KAAKC,IAAnC,GAA0C,EAArD,CAAX;AAAA,QAAqE;AACjEE,cAAUH,KAAKI,OAAL,IAAgBJ,KAAKI,OAAL,CAAaC,aAA7B,GAA6C,EAAEC,UAAU,EAAZ,EAAgBL,MAAMA,IAAtB,EAA7C,GAA4E,IAD1F;AAAA,QAEIM,kBAAkB,yBAAuBC,IAAvB,CAA4BL,OAA5B,CAFtB;AAAA,QAE4D;AACxDM,uBAAmB,0BAAwBD,IAAxB,CAA6BL,OAA7B,CAHvB;AAAA,QAG8D;AAC1DO,cAAU,0BAAWV,KAAKW,OAAL,KAAiB,KAA5B,CAJd;AAAA,QAKIC,aAAa,uBAAUZ,KAAKa,MAAf,CALjB;AAAA,QAMIA,MANJ;AAAA,QAOIC,gBAPJ;AAAA,QAQIC,sBAAsB,uCAR1B;;AAWA,QAAIf,KAAKgB,QAAL,IAAiB,CAACD,oBAAoBf,KAAKgB,QAAzB,CAAtB,EAA0D;AACtDC,gBAAQC,KAAR,CAAc,0BAAd,EAA0ClB,KAAKgB,QAA/C;AACAhB,aAAKgB,QAAL,GAAgB,2BAAhB;AACH;;AAEDF,uBAAmBL,iBAAiBT,KAAKmB,QAAL,IAAiB,EAAlC,CAAnB;;AAEA,QAAIP,UAAJ,EAAgB;AACZC,iBAASN,gBAAgBK,UAAhB,CAAT;AACH,KAFD,MAEO;AACHC,iBAAS,EAAEA,QAAQ,kBAAY,CAAG,CAAzB,EAAT;AACH;;AAED,QAAIb,KAAKoB,kBAAT,EAA6B;AACzB;AACA;AACA,YAAIC,WAAW;AACXA,sBAAU,kBAAUC,GAAV,EAAeC,OAAf,EAAwB;AAC9B,oBAAID,GAAJ,EAAS;AACLL,4BAAQO,GAAR,CAAY,oBAAZ,EAAkCF,GAAlC;AACArB,yBAAKqB,GAAL;AACA;AACH;AACDrB,qBAAKsB,OAAL;AACH;AARU,SAAf;AAUAhB,wBAAgBP,KAAKoB,kBAArB,EAAyCP,MAAzC,CAAgDQ,QAAhD;AACH;;AAED,WAAO,qBAAMrB,IAAN,EAAY;AACfc,0BAAkBA,gBADH;AAEfD,gBAAQA,MAFO;AAGfZ,cAAMA,IAHS;AAIfS,iBAASA,OAJM;AAKfP,iBAAS;AALM,KAAZ,CAAP;AAOH","file":"templateViewModel.js","sourcesContent":["import { createViewModel as createViewModelUnbound,\n    createViewModels as createViewModelsUnbound } from 'scalejs.metadataFactory'\nimport { getRegisteredTemplates } from 'scalejs.mvvm'\nimport { cloneDeep } from 'lodash';\nimport { observable } from 'knockout';\nimport { merge } from 'scalejs';\n\nexport default function templateViewModel(node) {\n    var data = observable(node.hasOwnProperty('data') ? node.data : {}), // ability to override initial data\n        context = node.options && node.options.createContext ? { metadata: [], data: data } : this,\n        createViewModel = createViewModelUnbound.bind(context), // passes context\n        createViewModels = createViewModelsUnbound.bind(context), // passes context\n        isShown = observable(node.visible !== false),\n        actionNode = cloneDeep(node.action),\n        action,\n        mappedChildNodes,\n        registeredTemplates = getRegisteredTemplates();\n\n\n    if (node.template && !registeredTemplates[node.template]) {\n        console.error('Template not registered ', node.template);\n        node.template = 'metadata_default_template';\n    }\n\n    mappedChildNodes = createViewModels(node.children || []);\n\n    if (actionNode) {\n        action = createViewModel(actionNode);\n    } else {\n        action = { action: function () { } };\n    }\n\n    if (node.dataSourceEndpoint) {\n        // create a callback object that the ajaxAction knows how to use.\n        // this is the alternative to the lously coupled nextactions[] || error actions.\n        var callback = {\n            callback: function (err, results) {\n                if (err) {\n                    console.log('ajax request error', err);\n                    data(err);\n                    return;\n                }\n                data(results);\n            }\n        }\n        createViewModel(node.dataSourceEndpoint).action(callback);\n    }\n\n    return merge(node, {\n        mappedChildNodes: mappedChildNodes,\n        action: action,\n        data: data,\n        isShown: isShown,\n        context: this\n    });\n}\n"]}