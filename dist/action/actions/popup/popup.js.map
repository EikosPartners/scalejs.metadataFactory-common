{"version":3,"sources":["../../../../src/action/actions/popup/popup.js"],"names":["popupRoot","initialized","popupAction","options","init","context","onHidePopup","actions","data","modal","merged","map","action","type","call","unwrap","message","render","hidePopupAction","evaluate","getValue","title","template","children","classes","renderPopup","wrapperTemplate","hidePopup","popupClasses","popupContent","name","hideDelay","setTimeout","closePopup","popupDiv","document","querySelector","att","createAttribute","value","createElement","setAttributeNode","body","insertBefore","lastChild","nextSibling","applyBindings","popup"],"mappings":"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","file":"popup.js","sourcesContent":["import { registerTemplates, registerBindings, template } from 'scalejs.mvvm';\r\nimport { createViewModel } from 'scalejs.metadataFactory';\r\nimport { registerActions } from '../../actionModule';\r\nimport { merge } from 'scalejs';\r\nimport popup from 'scalejs.popup';\r\nimport mustache from 'mustache';\r\nimport ko from 'knockout';\r\n\r\nimport popupBindings from './popupBindings';\r\nimport popupTemplates from './popup.html';\r\n\r\nconst popupRoot = popup.popupRoot;\r\nlet initialized = false;\r\n\r\n/**\r\n * Popup action creates a popup in the window\r\n *\r\n * @module popup\r\n *\r\n * @param {object} node\r\n *  The configuration object for the popup action\r\n * @param {string} node.type\r\n *  The type of the node is action\r\n * @param {string} node.actionType\r\n *  The actionType of the node is popup\r\n * @param {string} node.text\r\n *  The text to display on the button\r\n * @param {string} node.id\r\n *  The id of the popup\r\n * @param {string} node.buttonClasses\r\n *  A string of classes to apply the button\r\n * @param {object} node.options\r\n *  The options pertaining to the ajax action\r\n * @param {string} node.options.template\r\n *  The template to use to construct the popup\r\n * @param {string} node.options.title\r\n *  The title of the popup\r\n * @param {string} node.options.message\r\n *  The message to display in the popup\r\n * @param {object|array} node.options.data\r\n *  The data to pass to the popup to be mustache rendered\r\n * @param {boolean} node.options.modal\r\n *  Boolean to display the popup as a modal or not\r\n * @param {string} node.options.wrapperTemplate\r\n *  The template to use as the wrapper for the popup\r\n * @param {object} node.options.hidePopupAction\r\n *  The action to perform when the popup is hidden\r\n * @param {number} node.options.hideDelay\r\n *  The amount of time before the popup is closed in milliseconds\r\n *\r\n * @example\r\n * {\r\n *     \"type\": \"action\",\r\n *     \"actionType\": \"popup\",\r\n *     \"options\": {\r\n *         \"title\": \"Success\",\r\n *         \"template\": \"action_popup_template\",\r\n *         \"message\": \"Your form has been submitted successfully\"\r\n *     }\r\n * }\r\n */\r\nfunction popupAction(options) {\r\n    if (!initialized) { init(); }\r\n    const context = this;\r\n    let onHidePopup,\r\n        actions,\r\n        data,\r\n        modal,\r\n        merged;\r\n\r\n    actions = (options.actions || []).map((action) => {\r\n        action.type = 'action';\r\n        return createViewModel.call(context, action);\r\n    });\r\n\r\n    data = this && ko.unwrap(this.data);\r\n    data = merge(options, data);\r\n    \r\n    if (typeof options.message === 'string') {\r\n        options.message = mustache.render(options.message, data || {});\r\n    }\r\n\r\n    if (options.hidePopupAction) {\r\n        onHidePopup = createViewModel.call(context, options.hidePopupAction).action;\r\n    }\r\n\r\n    modal = typeof options.modal === 'undefined' || typeof options.modal === 'boolean' ? options.modal : evaluate(options.modal, this.getValue);\r\n\r\n    merged = merge(options, {\r\n        title: options.title,\r\n        message: options.message,\r\n        template: options.template,\r\n        actions: actions,\r\n        modal: modal,\r\n        options: options.children,\r\n        classes: options.classes,\r\n        onHidePopup: onHidePopup,\r\n        context: this\r\n    });\r\n\r\n    popup.onHidePopup(merged.onHidePopup);\r\n    popup.renderPopup(\r\n        template(merged.wrapperTemplate || 'popup_default_wrapper_template', {\r\n            hidePopup: popup.hidePopup,\r\n            title: merged.title || 'Popup',\r\n            modal: merged.modal || false,\r\n            popupClasses: merged.popupClasses,\r\n            classes: merged.classes,\r\n            popupContent: {\r\n                name: merged.template || 'popup_default_region_template',\r\n                data: merge(merged, {\r\n                    hidePopup: popup.hidePopup\r\n                })\r\n            }\r\n        })\r\n    );\r\n\r\n    if (options.hideDelay) {\r\n        setTimeout(closePopup, options.hideDelay);\r\n    }\r\n}\r\n\r\nfunction closePopup() {\r\n    popup.hidePopup();\r\n}\r\n\r\nfunction init() {\r\n    initialized = true;\r\n    let popupDiv = document.querySelector('*[data-bind=\"render: popupRoot\"], *[data-bind=\"render:popupRoot\"]');\r\n    if (!popupDiv) {\r\n        let att = document.createAttribute('data-bind');\r\n        att.value = 'render: popupRoot';\r\n        popupDiv = document.createElement('div');\r\n        popupDiv.setAttributeNode(att);\r\n        document.body.insertBefore(popupDiv, document.body.lastChild.nextSibling);\r\n        ko.applyBindings({ popupRoot }, popupDiv);\r\n    }\r\n}\r\n\r\nregisterBindings(popupBindings);\r\nregisterTemplates(popupTemplates);\r\nregisterActions({ popup: popupAction, closePopup: closePopup });"]}