{"version":3,"sources":["../../../../src/action/actions/popup/popup.js"],"names":["popupRoot","initialized","popupAction","options","init","context","message","onHidePopup","actions","data","modal","merged","map","action","type","call","render","hidePopupAction","evaluate","getValue","title","template","children","classes","renderPopup","wrapperTemplate","hidePopup","popupContent","name","hideDelay","setTimeout","closePopup","popupDiv","document","querySelector","att","createAttribute","value","createElement","setAttributeNode","body","insertBefore","lastChild","nextSibling","applyBindings","popup"],"mappings":"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","file":"popup.js","sourcesContent":["import { registerTemplates, registerBindings, template } from 'scalejs.mvvm';\nimport { createViewModel } from 'scalejs.metadataFactory';\nimport { registerActions } from '../../actionModule';\nimport { notify } from 'scalejs.messagebus';\nimport { merge } from 'scalejs';\nimport popup from 'scalejs.popup';\nimport mustache from 'mustache';\nimport ko from 'knockout'\n\nimport popupBindings from './popupBindings';\nimport popupTemplates from './popup.html';\n\nlet popupRoot = popup.popupRoot;\nlet initialized = false\n\nfunction popupAction(options) {\n    if (!initialized) { init(); }\n    let context = this,\n        message = {},\n        onHidePopup, actions, data, modal, merged;\n\n    actions = (options.actions || []).map(function (action) {\n        action.type = 'action';\n        return createViewModel.call(context, action);\n    });\n\n    data = this && this.data && this.data();\n\n    if (options.message) {\n        options.message = mustache.render(options.message, data || {});\n    }\n\n    if (options.hidePopupAction) {\n        onHidePopup = createViewModel.call(context, options.hidePopupAction).action;\n    }\n\n    modal = typeof options.modal === 'undefined' || typeof options.modal === 'boolean' ? options.modal : evaluate(options.modal, this.getValue);\n\n    merged = merge(options, {\n        title: options.title,\n        message: options.message,\n        template: options.template,\n        actions: actions,\n        modal: modal,\n        options: options.children,\n        classes: options.classes,\n        onHidePopup: onHidePopup,\n        context: this\n    });\n\n    popup.onHidePopup(merged.onHidePopup);\n    popup.renderPopup(\n        template(merged.wrapperTemplate || 'popup_default_wrapper_template', {\n            hidePopup: popup.hidePopup,\n            title: merged.title || 'Popup',\n            modal: merged.modal || false,\n            classes: merged.classes,\n            popupContent: {\n                name: merged.template || 'popup_default_region_template',\n                data: merge(merged, {\n                    hidePopup: popup.hidePopup\n                })\n            }\n        })\n    );\n\n    if (options.hideDelay) {\n        setTimeout(closePopup, options.hideDelay);\n    }\n}\n\nfunction closePopup() {\n    popup.hidePopup();\n}\n\nfunction init() {\n    initialized = true;\n    let popupDiv = document.querySelector('*[data-bind=\"render: popupRoot\"], *[data-bind=\"render:popupRoot\"]');\n    if (!popupDiv) {\n        let att = document.createAttribute('data-bind');\n        att.value = 'render: popupRoot';\n        popupDiv = document.createElement('div');\n        popupDiv.setAttributeNode(att);\n        document.body.insertBefore(popupDiv, document.body.lastChild.nextSibling);\n        ko.applyBindings({popupRoot}, popupDiv);\n    }\n    \n}\n\nregisterBindings(popupBindings);\nregisterTemplates(popupTemplates);\nregisterActions({ popup: popupAction, closePopup: closePopup });"]}