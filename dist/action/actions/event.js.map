{"version":3,"sources":["../../../src/action/actions/event.js"],"names":["renderParams","params","data","ret","JSON","parse","render","stringify","ex","console","error","event","options","optionData","paramsKey","target"],"mappings":";;AAAA;;AACA;;AACA;;AACA;;;;AAEA;;;;AAEA,SAASA,YAAT,CAAsBC,MAAtB,EAA8BC,IAA9B,EAAoC;AAChC,QAAIC,MAAMF,MAAV;AACA,QAAI;AACAE,cAAMC,KAAKC,KAAL,CACF,mBAASC,MAAT,CAAgBF,KAAKG,SAAL,CAAeN,MAAf,CAAhB,EAAwCC,IAAxC,CADE,CAAN;AAGH,KAJD,CAIE,OAAOM,EAAP,EAAW;AACTC,gBAAQC,KAAR,CAAc,uCAAd,EAAuDF,EAAvD;AACH;;AAED,WAAOL,GAAP;AACH;;AAGD,SAASQ,KAAT,CAAeC,OAAf,EAAwB;AACpB,QAAMV,OAAO,sBAAO,QAAQ,KAAKA,IAApB,CAAb;AAAA,QACIW,aAAaD,QAAQV,IAAR,IAAgB,EADjC;AAEA,QAAID,SAASW,QAAQX,MAArB;;AAEA,QAAIW,QAAQE,SAAZ,EAAuB;AACnBb,iBAAS,qBAAMA,UAAU,EAAhB,EAAoBW,QAAQA,QAAQE,SAAhB,CAApB,CAAT;AACH;;AAED,QAAIb,UAAUW,QAAQZ,YAAR,KAAyB,KAAvC,EAA8C;AAC1CC,iBAASD,aAAaC,MAAb,EAAqB,qBAAMC,IAAN,EAAYW,UAAZ,CAArB,CAAT;AACH;;AAED,yBAAO,sBAAOD,QAAQG,MAAf,CAAP,EAA+Bd,MAA/B;AACH;;AAED,mCAAgB,EAAEU,YAAF,EAAhB","file":"event.js","sourcesContent":["import { notify } from 'scalejs.messagebus';\r\nimport { unwrap } from 'knockout';\r\nimport { merge } from 'scalejs';\r\nimport mustache from 'mustache';\r\n\r\nimport { registerActions } from '../actionModule';\r\n\r\nfunction renderParams(params, data) {\r\n    let ret = params;\r\n    try {\r\n        ret = JSON.parse(\r\n            mustache.render(JSON.stringify(params), data)\r\n        );\r\n    } catch (ex) {\r\n        console.error('Unable to JSON parse/stringify params', ex);\r\n    }\r\n\r\n    return ret;\r\n}\r\n\r\n\r\nfunction event(options) {\r\n    const data = unwrap(this && this.data),\r\n        optionData = options.data || {};\r\n    let params = options.params;\r\n\r\n    if (options.paramsKey) {\r\n        params = merge(params || {}, options[options.paramsKey]);\r\n    }\r\n\r\n    if (params && options.renderParams !== false) {\r\n        params = renderParams(params, merge(data, optionData));\r\n    }\r\n\r\n    notify(unwrap(options.target), params);\r\n}\r\n\r\nregisterActions({ event });\r\n\r\n"]}