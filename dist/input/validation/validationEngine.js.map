{"version":3,"sources":["../../../src/input/validation/validationEngine.js"],"names":[],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;;;;AAOI,mBAAG,UAAH,CAAc,IAAd,CAAmB;AACf,oBAAgB,KADD;AAEf,wBAAoB,IAFL;AAGf,qBAAiB,KAHF;AAIf,+BAA2B,KAJZ;AAKf,0BAAsB;AALP,CAAnB;;AAQA,mBAAG,UAAH,CAAc,KAAd,CAAoB,YAApB,IAAoC;AAChC,eAAW,mBAAU,GAAV,EAAe,CAAf,EAAkB;AACzB,YAAI,SAAS,EAAE,MAAF,GAAW,EAAE,MAAb,GAAsB,CAAnC;AAAA,YACI,WAAW,OAAO,CAAP,CADf;AAAA,YAEI,YAAY,IAFhB;;AAIA,YAAG,CAAC,MAAM,OAAN,CAAc,OAAO,CAAP,CAAd,CAAJ,EAA8B;AAC1B,mBAAO,kBAAS,KAAT,CAAe,IAAf,EAAqB,MAArB,CAAP;AACH;;AAED,eAAO,OAAO,CAAP,EAAU,KAAV,CAAgB,UAAU,CAAV,EAAa;AAChC,gBAAI,UAAU,kBAAS,IAAT,CAAc,IAAd,EAAoB,EAAE,IAAtB,EAA4B,QAA5B,CAAd;AACA,gBAAG,CAAC,OAAJ,EAAa;AACT,0BAAU,OAAV,GAAoB,EAAE,OAAtB;AACH;AACD,mBAAO,OAAP;AACH,SANM,CAAP;AAOH,KAjB+B;AAkBhC,aAAS;AAlBuB,CAApC;;AAqBA,mBAAG,UAAH,CAAc,KAAd,CAAoB,cAApB,IAAsC;AAClC,eAAW,mBAAU,GAAV,EAAe,CAAf,EAAkB;AAC1B,YAAG,CAAC,GAAJ,EAAQ;AACJ,mBAAO,IAAP,C;AACH;;AAED,eAAO,iBAAE,SAAF,CAAY,CAAZ,EAAe,CAAC,OAAD,EAAU,GAAV,CAAf,IAAiC,CAAC,CAAzC;AACF,KAPiC;AAQlC,aAAS;AARyB,CAAtC;;AAWA,mBAAG,UAAH,CAAc,KAAd,CAAoB,aAApB,IAAqC;AACjC,eAAW,mBAAU,GAAV,EAAe,KAAf,EAAsB;AAC7B,YAAI,KAAJ,EAAW;AACP,iBAAK,OAAL,GAAe,KAAf;AACA,mBAAO,KAAP;AACH;AACD,eAAO,IAAP;AACH,KAPgC;AAQjC,aAAS;AARwB,CAArC;;AAWA,IAAI,mBAAmB,mBAAG,UAAH,CAAc,KAAd,CAAoB,SAApB,EAA+B,SAAtD;AACA,mBAAG,UAAH,CAAc,KAAd,CAAoB,SAApB,EAA+B,SAA/B,GAA2C,UAAU,GAAV,EAAe,MAAf,EAAuB;AAC9D,QAAI,YAAY,IAAhB;AACA,QAAI,MAAM,OAAN,CAAc,MAAd,CAAJ,EAA2B;AACvB,eAAO,OAAO,KAAP,CAAa,UAAU,KAAV,EAAiB;AACjC,gBAAI,UAAU,iBAAiB,GAAjB,EAAsB,MAAM,MAA5B,CAAd;AACA,gBAAI,CAAC,OAAL,EAAc;AACV,0BAAU,OAAV,GAAoB,MAAM,OAA1B;AACH;AACD,mBAAO,OAAP;AACH,SANM,CAAP;AAOH;AACD,WAAO,iBAAiB,GAAjB,EAAsB,MAAtB,CAAP;AACH,CAZD;;AAcA,mBAAG,UAAH,CAAc,iBAAd","file":"validationEngine.js","sourcesContent":["import { evaluate } from 'scalejs.expression-jsep';\nimport ko from 'knockout';\nimport _ from 'lodash';\nimport 'knockout.validation';\n       \n    /*\n    * made validation engine its own file to support more complex logic\n    */\n\n    //set the generic validation on the knockout binding\n    ko.validation.init({\n        insertMessages: false,\n        messagesOnModified: true,\n        decorateElement: false,\n        decorateElementOnModified: false,\n        decorateInputElement: false\n    });\n\n    ko.validation.rules['expression'] = {\n        validator: function (val, p) {\n            var params = p.params ? p.params : p,\n                getValue = params[1],\n                validator = this;\n            // option 1: params[0] is not an array so it is just the term\n            if(!Array.isArray(params[0])) {\n                return evaluate.apply(null, params);\n            }\n            // option 2: params[0] is an array so it is many terms\n            return params[0].every(function (e) {\n                var isValid = evaluate.call(null, e.term, getValue);\n                if(!isValid) {\n                    validator.message = e.message;\n                }\n                return isValid;\n            });\n        },\n        message: 'Expression is not correct'\n    };\n\n    ko.validation.rules['autocomplete'] = {\n        validator: function (val, p) {\n           if(!val){\n               return true; //if the value is undefined, then we ignore the validation.\n           }\n\n           return _.findIndex(p, ['value', val]) > -1;\n        },\n        message: 'Expression is not correct'\n    };\n\n    ko.validation.rules['customError'] = {\n        validator: function (val, error) {\n            if (error) {\n                this.message = error;\n                return false;\n            }\n            return true;\n        },\n        message: 'Value is not valid'\n    };\n    \n    var patternValidator = ko.validation.rules['pattern'].validator;\n    ko.validation.rules['pattern'].validator = function (val, params) {\n        var validator = this;\n        if (Array.isArray(params)) {\n            return params.every(function (param) {\n                var isValid = patternValidator(val, param.params);\n                if (!isValid) {\n                    validator.message = param.message;\n                }\n                return isValid;\n            });\n        }\n        return patternValidator(val, params);\n    }   \n    \n    ko.validation.registerExtenders();\n\n"]}